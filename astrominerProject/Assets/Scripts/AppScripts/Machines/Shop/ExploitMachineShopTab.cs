using SBaier.DI;
using TMPro;
using UnityEngine;
using UnityEngine.UI;

namespace SBaier.Astrominer
{
	public class ExploitMachineShopTab : MonoBehaviour, Injectable
	{
		[SerializeField]
		private Button _button;
		[SerializeField]
		private TextMeshProUGUI _label;
		[SerializeField]
		private string _labelTextBase = "Lvl {0}";

		private int _level;
		private ExploitMachineShop _shop;

		public void Inject(Resolver resolver)
		{
			_level = resolver.Resolve<int>();
			_shop = resolver.Resolve<ExploitMachineShop>();
		}

		private void Start()
		{
			UpdateButtonInteractive();
			UpdateLabelText();
			_shop.OnSelectedLevelChange += UpdateButtonInteractive;
			_button.onClick.AddListener(SelectLevel);
		}

		private void OnDestroy()
		{
			_shop.OnSelectedLevelChange -= UpdateButtonInteractive;
			_button.onClick.RemoveListener(SelectLevel);
		}

		private void UpdateButtonInteractive()
		{
			_button.interactable = _shop.SelectedLevel != _level;
		}

		private void UpdateLabelText()
		{
			_label.text = string.Format(_labelTextBase, _level + 1);
		}

		private void SelectLevel()
		{
			_shop.Select(_level);
		}
	}
}
